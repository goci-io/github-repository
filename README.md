# github-repository

This module provisions a new github repository. A new project consists of the following:

- Initial `README.md`, `LICENSE` and `.gitignore` file  
- GitHub Actions to build and deploy the project (optional)  
- Webhook for push events, including a secret (optional)  

Changes to any file, unrelated to the project itself (eg. github actions), are commited and pushed to a new branch.
You are responsible to create new pull requests, review and accept them.

A bare example and change history can be found [here](https://github.com/goci-io/goci-repository-setup-example).
This example is generated based on the terraform.tfvars.example.

### Usage

```hcl
module "repository" {
  source                   = "git::https://github.com/goci-io/github-repository.git?ref=tags/<latest-version>"
  repository_name          = "goci-repository-setup-example"
  github_organization      = "goci-io"
  create_webhook           = false
  create_branch_protection = false
  topics                   = ["projectX"]
  account_id               = "123456789"
  project_id               = "abc123"
}
```

Look into the [terraform.tfvars](terraform.tfvars.example) example file or find more variables in the [variables.tf](variables.tf).
You also need to make sure to have a valid token set in `GITHUB_TOKEN` environment variable to configure the terraform provider.

### Configuration

| Name | Description | Default |
|-----------------|----------------------------------------|---------|
| github_base_url | The base url to github | `github.com` |
| github_organization | The organization name to create resources for | - |
| create_repository | Creates the repository if set to true | `true` |
| repository_name | The name of the repository | - |
| repository_description | Short description of the repository | `Repository created by goci-io/github-repository` |
| repository_visibility_private | If set to true the repository will be private | `false` | 
| topics | List of strings as topis to attach to the repository | `[]` |
| homepage_url | URL to a homepage on the repository | - |
| description | Initial README description | `repository_description` | 
| create_branch_protection | Creates a branch protection for the master branch | `true` |
| create_webhook | Creates the webhook for push events if set to true | `true` |
| webhook_push_name | Identifier for the webhook with push events | `trigger-change-update` |
| webhook_push_url | The URL to send the webhook events to | - |
| webhook_push_secret | The secret to include in the webhook | autogenerated |
| license_template | Name of license template to use | `apache-2.0` |
| gitignore_template | Name of the gitignore template to use | - |
| ssh_key_file | Path to the SSH key file to use | `~/.ssh/git_rsa` |
| project_id | A unique project id | - |
| account_id | Goci Account ID | - |
| actions | Map of actions and config to enable | `{}` |

Example action configuration:
```hcl
actions = {
  template-name = {
    config-data-key = value
  },
  ...
}
```

The template name should reference a file created in [`templates`](https://github.com/goci-io/github-repository/tree/master/templates) directory ending with `.yaml`.
By default the following action templates are already included:  
- [actions/terraform-app-deployment](https://github.com/goci-io/github-repository/tree/master/templates/actions/goci-terraform-app-deployment.yaml)  

#### Todos
- Allow to use without goci context (project- and account-id)  
